<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>R2D2 Arm Connected to RPI3 With Micro Maestro :: Rico.ai — My notes in the AI world.</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="RPI3 You can use the RPI3 to use the servos. But the servo power will need to separte from the RPI3. The RPI3&amp;rsquo;s 5V is not enough to use servos long term. For initial testing they will work. But what you will find is the servos will glitch if connected to the RPI3&amp;rsquo;s header. The RPI3 causes the glitches. So eventually you need to find an alternative way to run the servos."/>
<meta name="keywords" content=""/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="/blog/r2d3-arms-rpi3-maestro/" />


<link rel="stylesheet" href="/assets/style.css">


<link rel="stylesheet" href="/style.css">


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="/img/favicon.png">


<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="R2D2 Arm Connected to RPI3 With Micro Maestro :: Rico.ai — My notes in the AI world." />
<meta name="twitter:description" content="RPI3 You can use the RPI3 to use the servos. But the servo power will need to separte from the RPI3. The RPI3&amp;rsquo;s 5V is not enough to use servos long term. For initial testing they will work. But what you will find is the servos will glitch if connected to the RPI3&amp;rsquo;s header. The RPI3 causes the glitches. So eventually you need to find an alternative way to run the servos." />
<meta name="twitter:site" content="/" />
<meta name="twitter:creator" content="Rico Castelo" />
<meta name="twitter:image" content="/images/blog/r2d2-arms-rpi3/sch_maestro_sm.png">


<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="R2D2 Arm Connected to RPI3 With Micro Maestro :: Rico.ai — My notes in the AI world.">
<meta property="og:description" content="RPI3 You can use the RPI3 to use the servos. But the servo power will need to separte from the RPI3. The RPI3&amp;rsquo;s 5V is not enough to use servos long term. For initial testing they will work. But what you will find is the servos will glitch if connected to the RPI3&amp;rsquo;s header. The RPI3 causes the glitches. So eventually you need to find an alternative way to run the servos." />
<meta property="og:url" content="/blog/r2d3-arms-rpi3-maestro/" />
<meta property="og:site_name" content="R2D2 Arm Connected to RPI3 With Micro Maestro" />
<meta property="og:image" content="/images/blog/r2d2-arms-rpi3/sch_maestro_sm.png">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta property="article:published_time" content="2019-06-14 12:29:40 &#43;0600 &#43;0600" />








<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-131554734-1', 'auto');
	
	ga('send', 'pageview');
}
</script>


<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-1341867426077422",
    enable_page_level_ads: true
  });
</script>
</head>
<body class="dark-theme">
<div class="container">
  <header class="header">
  <span class="header__inner">
    <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" width="44" height="44" viewBox="0 0 44 44">
  <polyline fill="none" stroke="#000" stroke-width="2" points="15 8 29.729 22.382 15 35.367"/>
</svg>
</span>
    <span class="logo__text">rico.ai</span>
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about">About</a></li>
        
      
        
          <li><a href="/blog">Blog</a></li>
        
      
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about">About</a></li>
      
    
      
        <li><a href="/blog">Blog</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>

      </span>
    </span>
  </span>
</header>


  <div class="content">
    
  <div class="post">
    <h2 class="post-title"><a href="/blog/r2d3-arms-rpi3-maestro/">R2D2 Arm Connected to RPI3 With Micro Maestro</a></h2>
    <div class="post-meta">
      
        <span class="post-date">
            2019-06-14
        </span>
      
      <span class="post-author">— Written by Rico Castelo</span>
      
        <span class="post-read-time">— 4 min read</span>
      
    </div>

    
      <span class="post-tags">
        
          #<a href="/tags/r2d2/">R2D2</a>&nbsp;
        
          #<a href="/tags/rpi3/">RPI3</a>&nbsp;
        
          #<a href="/tags/servo/">servo</a>&nbsp;
        
          #<a href="/tags/maestro/">Maestro</a>&nbsp;
        
      </span>
    

    
      
        <img src="/images/blog/r2d2-arms-rpi3/sch_maestro_sm.png" class="" />
      
    

    <div class="post-content">
      

<h1 id="rpi3">RPI3</h1>

<p>You can use the RPI3 to use the servos.  But the servo power will need to separte from the RPI3.  The RPI3&rsquo;s 5V is not enough to use servos long term.  For initial testing they will work.  But what you will find is the servos will glitch if connected to the RPI3&rsquo;s header.  The RPI3 causes the glitches.  So eventually you need to find an alternative way to run the servos.  There are two options I had on hand: a Maestro Mirco and PCA9685.</p>

<h1 id="maestro-micro">Maestro Micro</h1>

<p>The Maestro Micro can be used, but it will require a 3.3V to 5V TTL level convert for the serial communication.  The Maestro Micro uses 5V TTL logic.  The RPI3 uses 3.3V TTL logic.  So for the 2 boards to communicate through serial communication, you will need a TTL level converter.  I ended up not using this board, because the RPI3 needs power, the Maestro Micro needs power and the TTL Level Convert needs power.  This required too many connections versus the PCA9685.  And the PCA9685 has 16 channels and I haved used it before in my DonkeyCar.</p>

<p>I do not plan to persue this board any more.  I will stick with the PCA9685 that you can see in my next blog post.</p>

<h1 id="schematic">Schematic</h1>

<p>
  <figure class="left" >
    <img src="https://rimstar.org/science_electronics_projects/servo_motor_with_raspberry_pi_and_pololu_maestro/circuit_for_servo_with_raspberry_pi_and_maestro_controller.jpg"   />
    
  </figure>


Image From: <a href="https://rimstar.org/science_electronics_projects/servo_motor_with_raspberry_pi_and_pololu_maestro.htm">https://rimstar.org/science_electronics_projects/servo_motor_with_raspberry_pi_and_pololu_maestro.htm</a></p>

<h1 id="rpi3-and-pca9685-running-the-servos">RPI3 and PCA9685 Running the Servos</h1>


<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="//www.youtube.com/embed/Fyyp-IoJuRk" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>


<h1 id="rpi3-running-the-servos">RPI3 Running the Servos</h1>


<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="//www.youtube.com/embed/q2yWD6PR1Eo" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>


<h1 id="code">Code</h1>

<h2 id="maestro-library">Maestro Library</h2>

<p>You will need to download the Maestro library.  You can find it on my github for now.  You will also need to configure the RPI3 to handle using the serial port.  The source code gives the instructions in the comments at the top.</p>

<p><a href="https://github.com/ricoai/R2D2/blob/master/controls/maestro.py">https://github.com/ricoai/R2D2/blob/master/controls/maestro.py</a></p>

<h2 id="source-code-used">Source Code Used</h2>

<p><a href="https://github.com/ricoai/R2D2/blob/master/controls/maestro_servo_control.py">https://github.com/ricoai/R2D2/blob/master/controls/maestro_servo_control.py</a></p>

<pre><code class="language-python">

import maestro
import time
import sys


class MaestroServoControl:
    &quot;&quot;&quot;
    Use the Maestro board to control the servos.
    1. Disable console serial
    sudo raspi-config select interfacing options -&gt; Serial -&gt; No -&gt; Yes save &amp; exit
    2. Install pyserial
    python -m pip install pyserial (may be a bit slow)
    3. Clone Repo
    git clone https://github.com/FRC4564/Maestro
    4. Disable bluetooth uart
    sudo nano /boot/config.txt
    append to bottom: dtoverlay=pi3-disable-bt
    save
    &quot;&quot;&quot;

    def __init__(self, comm_port='/dev/ttyACM0', min_servo=3000.0, max_servo=9000.0):
        &quot;&quot;&quot;
        Initialize the maestro.  Set the comm port if you need to set the specific.  Set the min
        and max servo pulse width if not default.
        :param comm_port: Comm port of the maestro.
        :param min_servo: Min servo pulse width in quarter seconds.
        :param max_servo: Max servo pulse width in quarter seconds.
        &quot;&quot;&quot;
        self.comm_port = comm_port                              # Serial comm port
        self.maestro = None                                     # Hold the maestro controller

        self.min_servo = min_servo                              # Min pulse width of servo in quarter seconds
        self.max_servo = max_servo                              # Max pulse width of servo in quarter seconds

        self.setup_controller()                                 # Setup maestro

    def setup_controller(self):
        &quot;&quot;&quot;
        Setup the maestro controller
        :return:
        &quot;&quot;&quot;
        self.maestro = maestro.Controller(self.comm_port)
        self.maestro.setRange(0, self.min_servo, self.max_servo)
        print(&quot;Min Servo: &quot; + str(self.maestro.getMin(0)))
        print(&quot;Max Servo: &quot; + str(self.maestro.getMax(0)))

    def shutdown(self):
        &quot;&quot;&quot;
        Shutdown the object.  This will properly shutdown everything.
        :return:
        &quot;&quot;&quot;
        self.maestro.close()

    def center(self):
        &quot;&quot;&quot;
        Center the servo.
        :return:
        &quot;&quot;&quot;
        self.set_angle(0.0)  # CENTER (6000)

    def set_angle(self, chan, angle):
        &quot;&quot;&quot;
        Set the servo to the given angle.
        :param chan: Servo channel to move
        :param angle: Angle to move the servo
        :return:
        &quot;&quot;&quot;
        if angle &gt; 180:
            angle = 180
        if angle &lt; 0:
            angle = 0

        curr_pos = self.maestro.getPosition(chan)
        print(&quot;Current Servo Position: &quot; + str(chan) + &quot; pw: &quot; + str(curr_pos))

        pw = self.calc_quater_sec_pulse_width(angle)

        print(&quot;Servo: &quot; + str(chan) + &quot; angle: &quot; + str(angle) + &quot; pw: &quot; + str(pw))

        self.maestro.setTarget(chan, int(pw))

        new_pos = self.maestro.getPosition(chan)
        print(&quot;New Servo Position: &quot; + str(chan) + &quot; pw: &quot; + str(new_pos))

    def calc_quater_sec_pulse_width(self, angle):
        &quot;&quot;&quot;
        Calculate the pulse width in quarter seconds based off the angle given.
        :param angle:
        :return: Duty cycle for servo based off angle.
        &quot;&quot;&quot;
        if angle &lt;= 0.0:
            return self.min_servo
        if angle &gt;= 180.0:
            return self.max_servo

        return (self.max_servo + self.min_servo) / 180.0 * angle

    def set_speed(self, chan, speed):
        self.maestro.setSpeed(chan, speed)

    def set_accel(self, chan, speed):
        self.maestro.setAccel(chan, speed)


if __name__ == '__main__':
    #servos = MaestroServoControl(comm_port=&quot;/dev/ttyAMA0&quot;)
    #servos.set_speed(0, 10)
    #servos.set_speed(1, 10)
    #servos.set_angle(0, 90.0)
    #servos.set_angle(1, 90.0)
    #servos.shutdown()

    import maestro

    servo = maestro.Controller()
    servo.setAccel(0, 4)  # set servo 0 acceleration to 4
    servo.setTarget(0, 6000)  # set servo to move to center position
    servo.setSpeed(1, 10)  # set speed of servo 1
    x = servo.getPosition(1)  # get the current position of servo 1
    servo.close()
</code></pre>

<h1 id="parts-list">Parts List</h1>

<iframe style="width:120px;height:240px;" marginwidth="0" marginheight="0" scrolling="no" frameborder="0" src="//ws-na.amazon-adsystem.com/widgets/q?ServiceVersion=20070822&OneJS=1&Operation=GetAdHtml&MarketPlace=US&source=ss&ref=as_ss_li_til&ad_type=product_link&tracking_id=ricoai-20&language=en_US&marketplace=amazon&region=US&placement=B01M2DJ7B0&asins=B01M2DJ7B0&linkId=3006c8a1c5d7608846e3a22f2c40c85f&show_border=false&link_opens_in_new_window=true"></iframe>

<iframe style="width:120px;height:240px;" marginwidth="0" marginheight="0" scrolling="no" frameborder="0" src="//ws-na.amazon-adsystem.com/widgets/q?ServiceVersion=20070822&OneJS=1&Operation=GetAdHtml&MarketPlace=US&source=ss&ref=as_ss_li_til&ad_type=product_link&tracking_id=ricoai-20&language=en_US&marketplace=amazon&region=US&placement=B01E9320YC&asins=B01E9320YC&linkId=5e468835df4cd561a80d155b2744d6ba&show_border=false&link_opens_in_new_window=true"></iframe>

<iframe style="width:120px;height:240px;" marginwidth="0" marginheight="0" scrolling="no" frameborder="0" src="//ws-na.amazon-adsystem.com/widgets/q?ServiceVersion=20070822&OneJS=1&Operation=GetAdHtml&MarketPlace=US&source=ac&ref=tf_til&ad_type=product_link&tracking_id=ricoai-20&marketplace=amazon&region=US&placement=B01C6Q2GSY&asins=B01C6Q2GSY&linkId=4dee364acc60d2127e1062d32780aa4b&show_border=false&link_opens_in_new_window=true&price_color=333333&title_color=0066c0&bg_color=ffffff">
</iframe>

<iframe style="width:120px;height:240px;" marginwidth="0" marginheight="0" scrolling="no" frameborder="0" src="//ws-na.amazon-adsystem.com/widgets/q?ServiceVersion=20070822&OneJS=1&Operation=GetAdHtml&MarketPlace=US&source=ac&ref=tf_til&ad_type=product_link&tracking_id=ricoai-20&marketplace=amazon&region=US&placement=B011KLFERG&asins=B011KLFERG&linkId=39a63427cc61ccf9ed1e9f7eb5065c7d&show_border=false&link_opens_in_new_window=true&price_color=333333&title_color=0066c0&bg_color=ffffff">
    </iframe>

<iframe style="width:120px;height:240px;" marginwidth="0" marginheight="0" scrolling="no" frameborder="0" src="//ws-na.amazon-adsystem.com/widgets/q?ServiceVersion=20070822&OneJS=1&Operation=GetAdHtml&MarketPlace=US&source=ss&ref=as_ss_li_til&ad_type=product_link&tracking_id=ricoai-20&language=en_US&marketplace=amazon&region=US&placement=B01BV3Z342&asins=B01BV3Z342&linkId=e9cf697cd6e1707e33badba15d0de643&show_border=false&link_opens_in_new_window=true"></iframe>

<iframe style="width:120px;height:240px;" marginwidth="0" marginheight="0" scrolling="no" frameborder="0" src="//ws-na.amazon-adsystem.com/widgets/q?ServiceVersion=20070822&OneJS=1&Operation=GetAdHtml&MarketPlace=US&source=ss&ref=as_ss_li_til&ad_type=product_link&tracking_id=ricoai-20&language=en_US&marketplace=amazon&region=US&placement=B0194WDVHI&asins=B0194WDVHI&linkId=b17bfb5f5f79602af229c7ec70bb0209&show_border=false&link_opens_in_new_window=true"></iframe>

<iframe style="width:120px;height:240px;" marginwidth="0" marginheight="0" scrolling="no" frameborder="0" src="//ws-na.amazon-adsystem.com/widgets/q?ServiceVersion=20070822&OneJS=1&Operation=GetAdHtml&MarketPlace=US&source=ss&ref=as_ss_li_til&ad_type=product_link&tracking_id=ricoai-20&language=en_US&marketplace=amazon&region=US&placement=B00M8TXSBO&asins=B00M8TXSBO&linkId=1bd768e540d0e2761dbce574b2770fce&show_border=false&link_opens_in_new_window=true"></iframe>

<p>The R2D2 arm holder can be found at <a href="http://astromech.com/">http://astromech.com/</a></p>

    </div>
    
      <div class="pagination">
        <div class="pagination__title">
          <span class="pagination__title-h">Read other posts</span>
          <hr />
        </div>
        <div class="pagination__buttons">
          
            <span class="button previous">
              <a href="/blog/r2d3-arms-rpi3-pca9685/">
                <span class="button__icon">←</span>
                <span class="button__text">R2D2 Arm Connected to RPI3 With PCA9685</span>
              </a>
            </span>
          
          
            <span class="button next">
              <a href="/blog/r2d2-arms-rpi3/">
                <span class="button__text">R2D2 Arm Connected to RPI3</span>
                <span class="button__icon">→</span>
              </a>
            </span>
          
        </div>
      </div>
    

    <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "ricoai" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" width="44" height="44" viewBox="0 0 44 44">
  <polyline fill="none" stroke="#000" stroke-width="2" points="15 8 29.729 22.382 15 35.367"/>
</svg>
</span>
    <span class="logo__text">rico.ai</span>
    <span class="logo__cursor"></span>
  
</a>

      <div class="copyright">
        <span>© 2019 Powered by <a href="https://gohugo.io">Hugo</a></span>
        <span>Theme created by <a href="https://twitter.com/panr">panr</a></span>
      </div>
    
  </div>
</footer>

<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script>


  
</div>

</body>
</html>
